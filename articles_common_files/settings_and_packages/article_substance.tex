\NewDocumentEnvironment{substanceEnvironment}
{
    O{substance}
}
{
    \IfSubStr{#1}{substance}{
        % env beginning code
        % Change the margins
        %%% SUBSTANCE INFORMATION SECTION
        %%%%%% SUBSTANCE PAGES PARAMETERS
        \onehalfspacing %spacing between lines
        \parskip=0em % spacing between paragraphs (0pt plus 1pt default)
        \parindent=0pt % indent at start of each paragraph (15 default)
        % Font size in substance section
        \small
        %%%%%%
        %%% Subsubsection
        \titlespacing*{\subsubsection}{0pt}{0pt}{5pt}
        \titleformat{\subsubsection}
        {\vbox{\rule{1\textwidth}{0.1pt}\vspace{-0.5ex}}\small\color{wrtxGrayMed}}
        {\thesubsubsection}
        {0.1em}
        {\hspace{2em}} % change subsubsection style
        %%%%%% SUBSTANCE:
        \wrtxSectionTitle{Substance}
    }
    {%
        % No substance included
    }%
}
{
    % env ending code
}

\BeforeBeginEnvironment{substanceEnvironment}{
    \newgeometry{top=0.3cm,bottom=0.3cm,left=0.5cm,right=0.5cm}
}
\AfterEndEnvironment{substanceEnvironment}{\restoregeometry}


%%% To optionally add substance to each article in the portfolio
\newcommand{\addSubstanceToPortfolio}[1]
{%
    \ifthenelse{\boolean{isIncludePerArticleSubstance}}%
    {%
        \begin{substanceEnvironment}%
            #1%
        \end{substanceEnvironment}%
    }%
    {}
}%


\BeforeBeginEnvironment{substanceEnvironmentPORTFOLIO}{
    \newgeometry{top=0.3cm,bottom=0.3cm,left=0.5cm,right=0.5cm}
}
\AfterEndEnvironment{substanceEnvironmentPORTFOLIO}{\restoregeometry}




% Substance list
% EXPANDED LIST WITH LINE BREAKS BETWEEN ITEMS
\newlist{substanceList}{enumerate}{1}
\setlist[substanceList]{
    label={},
    align=right, % label alignment
    % labelwidth=0.25cm,
    topsep=0pt, % reduce space above list
    itemsep=0pt, % Sets the space between items
    parsep=0pt, % Sets the space between paragraphs within the items
    leftmargin=0pt, % * or 0pt
    labelsep=0pt, % Space between the bullet and the item text
}